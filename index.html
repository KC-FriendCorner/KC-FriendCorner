<!DOCTYPE html>
<html lang="th">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>KC FriendCorner - User Chat</title>
        
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link
            href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap"
            rel="stylesheet">
        
        <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
        
        <style>
            /* 1. Reset, Font, ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏Ç‡∏≠‡∏á Body */
            body {
                font-family: 'Sarabun', sans-serif;
                background-color: #f4f7f6;
                display: flex;
                justify-content: center;
                align-items: center; 
                min-height: 100vh;
                margin: 0;
                padding: 10px; 
            }
            
            /* 2. ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÅ‡∏•‡∏∞ Shadow */
            :root {
                --primary-color: #007bff;
                --secondary-color: #6c757d;
                --success-color: #28a745;
                --border-radius-xl: 16px; 
                --border-radius-lg: 12px;
                --border-radius-md: 8px;
                --shadow-lift: 0 6px 20px rgba(0, 0, 0, 0.15); 
                --transition-time: 0.3s;
            }

            /* 3. Main Container - ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ Responsive */
            #mainContainer {
                background-color: white;
                border-radius: var(--border-radius-xl);
                box-shadow: var(--shadow-lift);
                width: 100%; 
                max-width: 450px; 
                min-height: 500px;
                height: 95vh;
                display: flex;
                flex-direction: column;
                overflow: hidden;
                transition: max-width var(--transition-time), height var(--transition-time);
            }

            /* MEDIA QUERY ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Tablet/PC (‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏à‡∏≠‡πÉ‡∏´‡∏ç‡πà) */
            @media (min-width: 768px) and (orientation: landscape), (min-width: 992px) {
                #mainContainer {
                    max-width: 600px; 
                    height: 85vh;
                }
            }

            /* 4. Welcome/Start Screen (‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å) */
            #welcomeScreen {
                padding: 20px;
                text-align: center;
                display: flex;
                flex-direction: column;
                align-items: center;
                flex-grow: 1;
                justify-content: center; 
            }
            
            #logoArea {
                display: flex;
                justify-content: center;
                align-items: center;
                margin-bottom: 20px;
            }
            #logoArea img {
                width: 60px;
                height: 60px;
                object-fit: cover;
                border-radius: 50%;
                margin: 0 5px;
                border: 3px solid #eee;
            }
            #appTitle {
                font-size: 1.8rem;
                color: var(--primary-color);
                margin-bottom: 30px;
                font-weight: 700;
            }
            
            #userInfoArea {
                width: 100%;
                margin-bottom: 20px;
                padding: 10px 0;
                border-bottom: 1px solid #eee;
            }
            .user-info-text {
                color: var(--secondary-color);
                font-size: 0.9rem;
                font-weight: 500;
            }
            
            /* üö© ‡∏õ‡∏£‡∏±‡∏ö: ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á */
            #mainActions {
                display: flex;
                flex-direction: column;
                align-items: center; 
                width: 100%;
                max-width: 300px;
                margin: 0 auto; 
            }
            
            /* 5. Buttons */
            .primary-button, .secondary-button {
                border: none;
                padding: 12px 25px;
                border-radius: var(--border-radius-md);
                cursor: pointer;
                font-size: 1rem;
                font-weight: 600;
                margin-bottom: 10px;
                transition: all var(--transition-time);
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                width: 100%; 
                max-width: 300px;
            }
            .primary-button {
                background-color: var(--primary-color);
                color: white;
            }
            .primary-button:hover {
                background-color: #0056b3;
                transform: translateY(-2px);
            }
            .secondary-button {
                background-color: var(--secondary-color);
                color: white;
            }
            .secondary-button:hover {
                background-color: #5a6268;
                transform: translateY(-2px);
            }
            
            /* üö© ‡∏õ‡∏£‡∏±‡∏ö: ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á */
            #authButton {
                width: 80%;
                max-width: 300px;
                margin-left: auto;
                margin-right: auto;
            }


            /* 6. Chat Panel */
            #chatPanel, #chatScreen { 
                display: flex;
                flex-direction: column;
                flex-grow: 1;
                height: 100%; 
            }
            
            #chatHeader {
                padding: 15px;
                background-color: var(--primary-color);
                color: white;
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-top-left-radius: var(--border-radius-xl); 
                border-top-right-radius: var(--border-radius-xl);
                font-weight: 500;
            }
            #chatTitle {
                flex-grow: 1;
                text-align: center;
                font-size: 1.1rem;
                margin-right: -10px; 
            }
            #homeButton {
                background-color: transparent;
                color: white;
                border: 1px solid rgba(255, 255, 255, 0.5);
                padding: 6px 10px;
                border-radius: var(--border-radius-md);
                cursor: pointer;
                font-size: 0.9rem;
                transition: background-color 0.2s;
            }
            #homeButton:hover {
                background-color: rgba(255, 255, 255, 0.15);
            }

            /* 7. Chat Box ‡πÅ‡∏•‡∏∞ Input */
            #chatBox {
                flex-grow: 1;
                padding: 15px;
                overflow-y: auto;
                background-color: #fcfcfc;
                min-height: 50px; 
            }
            
            .input-area {
                padding: 10px 15px;
                border-top: 1px solid #eee;
                display: flex;
                align-items: flex-end; 
                flex-shrink: 0;
            }
            
            #chatInput {
                flex-grow: 1;
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 20px;
                resize: none;
                margin-right: 10px;
                font-size: 1rem;
                font-family: 'Sarabun', sans-serif;
            }

            /* üö© ‡∏õ‡∏£‡∏±‡∏ö: ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏° */
            #sendButton {
                padding: 10px 12px;
                border-radius: 50%; 
                width: 40px; 
                height: 40px;
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 1rem;
            }
            #sendButton i {
                 margin-right: 0 !important;
            }
            
            /* 8. Message Styles */
            .message {
                display: flex;
                margin-bottom: 10px;
                max-width: 80%;
                align-items: flex-end;
            }
            .bubble {
                padding: 10px 12px;
                border-radius: 18px;
                line-height: 1.4;
                word-wrap: break-word;
            }
            .user-message {
                justify-content: flex-end;
                margin-left: auto;
            }
            .user-message .bubble {
                background-color: var(--primary-color);
                color: white;
                border-bottom-right-radius: 2px;
            }
            .friend-message {
                justify-content: flex-start;
                margin-right: auto;
            }
            .friend-message .bubble {
                background-color: #e2e6ea;
                color: #333;
                border-bottom-left-radius: 2px;
            }
            .system-message {
                justify-content: center;
                text-align: center;
                margin: 10px auto;
                font-style: italic;
                font-size: 0.85rem;
                color: var(--secondary-color);
            }
            .system-message .bubble {
                background: none;
                padding: 0;
                border-radius: 0;
            }
            
            .delete-message-btn {
                font-size: 0.8rem;
                margin-left: 5px !important;
                margin-bottom: 5px;
                align-self: flex-end !important;
            }

        </style>
    </head>
    <body>

        <div id="mainContainer">

            <div id="welcomeScreen"> 

                <div id="logoArea">
                    <img id="appLogo"
                        src="https://khanchai.ac.th/images/logo.png"
                        alt="School Logo">
                    <img id="newLogo" src="TOBEKC.jpg.jpg"
                        alt="Support Group Logo">
                </div>

                <h1 id="appTitle">KC FriendCorner</h1>

                <div id="userInfoArea" style="display: none;">
                    <p id="userIdDisplay" class="user-info-text"></p>
                </div>

                <div id="startScreen" style="width: 100%; text-align: center;">

                    <button id="authButton" class="primary-button"
                        onclick="handleAuth()">
                        <i class="fas fa-sign-in-alt"></i> **‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡∏™‡∏∏‡πà‡∏°
                        ID)**
                    </button>

                    <br><br>

                    <div id="mainActions"
                        style="display:none;">
                        
                        <button id="startChat" class="primary-button">
                            <i class="fas fa-comment-dots"></i>
                            ‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏ô‡∏ó‡∏ô‡∏≤
                        </button>

                        <button id="logoutBtn" class="secondary-button"
                            onclick="userLogout()">
                            <i class="fas fa-sign-out-alt"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                    </div>

                </div>

            </div>

            <div id="chatScreen"
                style="display:none; flex-direction: column; flex-grow: 1;">

                <div id="chatHeader">
                    <button id="homeButton" onclick="showStartScreen()">
                        <i class="fas fa-home"></i> ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
                    </button>
                    <span id="chatTitle">‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÉ‡∏´‡∏°‡πà</span>
                    <div style="width: 70px;">&nbsp;</div>
                </div>

                <div id="chatBox">
                </div>

                <div class="input-area">
                    <textarea id="chatInput"
                        placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..."></textarea>
                    <button id="sendButton" class="primary-button">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>

            </div>

        </div>

        <audio id="notifySound" src="notify.mp3" preload="auto"></audio>

        <script
            src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
        <script
            src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
        <script
            src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

        <script src="user.js"></script>

    </body>
</html>